(()=>{"use strict";var e={p:"/public/"};e.p;function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i,o,r,c="buz-wc-modal-add-shipping-method",d="buz-wc-modal-change-shipping-method",s="buz-wc-modal-get-shipping-services",_=window.jQuery;function u(e){var t=_("#boekuwzending_order_metabox");t.off("click",'[data-action="add_shipping_method"]'),t.off("click",'[data-action="get_shipping_services"]'),t.off("click",'[data-action="create_shipping"]'),t.off("click",'[data-action="create_additional_label"]'),t.off("click",'[data-action="retrieve_status"]'),t.off("click",'[data-action="choose_pickup_point"]'),e&&l(),_.ajax({method:"POST",dataType:"html",url:buz_wc_settings.ajax_url,data:{action:"boekuwzending_admin_metabox_order_render",security:buz_wc_settings.ajax_nonce,orderId:buz_wc_settings.order_id,isNewOrder:buz_wc_settings.is_new_order}}).done((function(n){t.html(n),function(){var e=_("#boekuwzending_order_metabox");e.on("click",'[data-action="add_shipping_method"]',(function(e){e.preventDefault(),i=null;var t=f();t?alert(t):_("body").WCBackboneModal({template:c})})).on("click",'[data-action="get_shipping_services"]',(function(e){return function(e){e.preventDefault();var t=_(e.currentTarget).attr("href"),n=new URL(t);r=n.searchParams.has("order_id")?n.searchParams.get("order_id"):null;_("body").WCBackboneModal({template:s})}(e)})).on("click",'[data-action="create_shipping"]',(function(t){t.preventDefault(),l(),e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:"boekuwzending_admin_create_shipment",security:buz_wc_settings.ajax_nonce,orderId:buz_wc_settings.order_id}}).done((function(e){var t=e.data;"notesHtml"in t&&g(t.notesHtml),u(),w()})).fail(v)})).on("click",'[data-action="create_additional_label"]',(function(e){e.preventDefault(),l(),_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:"boekuwzending_admin_create_additional_label",security:buz_wc_settings.ajax_nonce,orderId:buz_wc_settings.order_id}}).done((function(e){var t=e.data;"notesHtml"in t&&g(t.notesHtml),u(),w()})).fail(v)})).on("click",'[data-action="retrieve_status"]',(function(e){e.preventDefault(),l(),_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:"boekuwzending_admin_retrieve_status",security:buz_wc_settings.ajax_nonce,orderId:buz_wc_settings.order_id}}).done((function(){u()})).fail(v)})).on("click",'[data-action="choose_pickup_point"]',(function(e){e.preventDefault();var t=_(e.currentTarget).attr("data-distributor");i="pickup";var n=f();if(n)alert(n);else{var a=b(),r=a.postcode,c=a.country;o.show({postcode:r.replace(" ",""),country:c,filter:{distributor:[t]}})}})),_('[data-buz-tooltip="true"]').tipTip({attribute:"title",fadeIn:50,fadeOut:50,delay:200})}(),e&&p()}))}function l(){_("#boekuwzending_order_metabox").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function p(){_("#boekuwzending_order_metabox").unblock()}function g(e){_(".order_notes","#woocommerce-order-notes").replaceWith(e)}function b(){return{address:_("#_shipping_address_1").val(),postcode:_("#_shipping_postcode").val(),city:_("#_shipping_city").val(),country:_("#_shipping_country").val()}}function f(){var e=b(),t=e.address,n=e.postcode,a=e.city,i=e.country,o=null;return t||n||a||i||(o=buz_wc_settings.i18n_no_shipping_information),n?t?a?i||(o=buz_wc_settings.i18n_no_shipping_country):o=buz_wc_settings.i18n_no_shipping_city:o=buz_wc_settings.i18n_no_shipping_address:o=buz_wc_settings.i18n_no_shipping_postcode,o}function m(e){return"delivery"===e?"boekuwzending_get_delivery_rates":"pickup"===e?"boekuwzending_get_pickup_rates":"boekuwzending_get_rates"}function h(e){return"delivery"===e?"boekuwzending_admin_save_delivery":"pickup"===e?"boekuwzending_admin_save_pick_up_point":"boekuwzending_admin_add_shipping_method"}function w(){_("#woocommerce-order-items").trigger("wc_order_items_reload")}function v(e){var t=JSON.parse(e.responseText).data;t&&(_(t).insertAfter(".wp-header-end"),_(document).trigger("wp-updates-notice-added")),p()}_(document).ready((function(){var e,t=this,a=null,p=[];(e=new URL(buz_wc_settings.url)).searchParams.append("token",buz_wc_settings.token),o=new BuzPickupPointLoader({url:e,onSelect:function(e){var t=e.identifier,n=e.name,a=e.distributor,i=e.address;_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:h("pickup"),security:buz_wc_settings.ajax_nonce,orderId:buz_wc_settings.order_id,pick_up_point:{identifier:t,name:n,distributor:a,address:i}}}).done((function(e){!1===e.success?alert(buz_wc_settings.i18n_error_while_saving_pick_up):(w(),u(!0))})).fail(v)}}),_("body").on("wc_backbone_modal_loaded",(function(e,t){if(t===c){var a=b(),o=a.address,u=a.postcode,l=a.city,g=a.country;_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:m(),security:buz_wc_settings.ajax_nonce,destination:{address:o,postcode:u,city:l,country:g}}}).done((function(e){var t=e.success,n=e.data;if(!1===t)alert(buz_wc_settings.i18n_unknown_error_occured);else{p=n;var a=[];n.forEach((function(e){a.push('\n                                <tr>\n                                    <td>\n                                        <label>\n                                            <input type="radio" name="service_id" value="'.concat(e.id,'" data-costs="').concat(e.cost,'" data-meta_data="').concat(JSON.stringify(e.meta_data),'" /> ').concat(e.label,"\n                                        </label>\n                                    </td>\n                                    <td>&euro; ").concat(e.cost.toFixed(2),"</td>\n                                </tr>\n                            "))})),_("#modal_shipping_method_results").html(a.join(""))}}))}if(t===d){var f=b(),h=f.address,w=f.postcode,v=f.city,z=f.country;_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:m(i),security:buz_wc_settings.ajax_nonce,destination:{address:h,postcode:w,city:v,country:z}}}).done((function(e){var t=e.success,n=e.data;if(!1===t)alert(buz_wc_settings.i18n_unknown_error_occured);else{p=n;var a=[];n.forEach((function(e){a.push('\n                                <tr>\n                                    <td>\n                                        <label>\n                                            <input type="radio" name="service_id" value="'.concat(e.id,'" data-costs="').concat(e.cost,'" data-meta_data="').concat(JSON.stringify(e.meta_data),'" /> ').concat(e.label,"\n                                        </label>\n                                    </td>\n                                    <td>&euro; ").concat(e.cost.toFixed(2),"</td>\n                                </tr>\n                            "))})),_("#modal_shipping_method_results").html(a.join(""))}}))}if(t===s){var y=_("#get_services_form"),k=y.closest(".wc-backbone-modal-main").find("footer");k.hide();var j=r;j||(j=buz_wc_settings.order_id),y.on("submit",(function(e){e.preventDefault(),e.stopPropagation();var t=_(this).serializeArray().reduce((function(e,t){return e[t.name]=t.value,e}),{});_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:"boekuwzending_admin_get_services",security:buz_wc_settings.ajax_nonce,item:n({orderId:j},t)}}).done((function(e){var t=e,n=[];t.length>0?(t.forEach((function(e){n.push('\n                                <tr>\n                                    <td>\n                                        <label>\n                                            <input type="radio" name="service_id" value="'.concat(e.id,'" data-costs="').concat(e.price,'" /> ').concat(e.description,"\n                                        </label>\n                                    </td>\n                                    <td>&euro; ").concat(e.price.toFixed(2),"</td>\n                                </tr>\n                            "))})),k.show()):n.push('\n                                <tr>\n                                    <td colspan="2" style="text-align: left;">\n                                        Geen verzendmogelijkheden gevonden voor de opgegeven dimensies  \n                                    </td>\n                                </tr>\n                            '),_("#modal_shipping_method_results").html(n.join(""))}))}))}})).on("wc_backbone_modal_response",(function(e,t,n){if(t===c){var o=null;if(p.forEach((function(e){n.service_id===e.id&&(o=e)})),null===o)return void alert(buz_wc_settings.i18n_no_shipping_rate_found);l(),_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:h(i),security:buz_wc_settings.ajax_nonce,orderId:buz_wc_settings.order_id,rate:o}}).done((function(e){!1===e.success?alert(buz_wc_settings.i18n_error_while_saving_rate):(w(),u())}))}if(t===d){var g=null;if(p.forEach((function(e){n.service_id===e.id&&(g=e)})),null===g)return void alert(buz_wc_settings.i18n_no_shipping_rate_found);l(),_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:h(i),security:buz_wc_settings.ajax_nonce,orderId:buz_wc_settings.order_id,orderItemId:a,rate:g}}).done((function(e){!1===e.success?alert(buz_wc_settings.i18n_error_while_saving_rate):(w(),u())}))}if(t===s){var b=r;b||(b=buz_wc_settings.order_id),_.ajax({method:"POST",url:buz_wc_settings.ajax_url,data:{action:"boekuwzending_admin_create_shipment",security:buz_wc_settings.ajax_nonce,orderId:b,data:n}}).done((function(e){location.reload()}))}})),_(document).ajaxSuccess((function(e,t,n){var a=Object.fromEntries(new URLSearchParams(n.data));"woocommerce_add_order_item"!==a.action&&"woocommerce_remove_order_item"!==a.action||u(!0)})),_("#woocommerce-order-items").on("click",'[data-action="change_shipping_method"]',(function(e){e.preventDefault();var n=_(e.currentTarget);i="delivery",a=_(n).attr("data-id");var o=f();o?alert(o):_(t).WCBackboneModal({template:d})})).on("click",'[data-action="choose_pickup_point"]',(function(e){e.preventDefault();var t=_(e.currentTarget),n=t.attr("data-distributor");i="pickup",a=_(t).attr("data-id");var r=f();if(r)alert(r);else{var c=b(),d=c.postcode,s=c.country;o.show({postcode:d.replace(" ",""),country:s,filter:{distributor:[n]}})}})).on("change",".shipping_method",(function(e){var t=_(e.currentTarget),n=t.closest(".shipping"),a="buz_wc_shipping_method_delivery"===t.val(),i="buz_wc_shipping_method_pickuppoint"===t.val();n.find('[data-action="choose_shipping_method"]').toggle(a),n.find('[data-action="choose_pickup_point"]').toggle(i),n.find(".shipping_method_name").val("Verzendmethoden")})),u(!0)}))})();